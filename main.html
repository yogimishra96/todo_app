<html>
    <head>
        <title> To do App </title> 
        <link rel="stylesheet" href="css/style.css">
        <link rel="stylesheet" href="bootstrap/css/bootstrap.min.css">

        <script src = "js/jquery.js" ></script>
        <script src = "js/jquery.min.js" ></script>
        
                
    </head>
    <body>

        <nav class="navbar  navbar-dark fixed-top bg-dark">
             <a class="navbar-brand" href="#">To Do App</a>
        </nav>

          <!-- Main jumbotron for a primary marketing message or call to action -->
        <div class="jumbotron">
            <div class="container">
                <div class="row">
                    <div class="col-lg-3 remainingcountcss ">
                        <span class="remainingCountHere">Uncompleted : <b>5</b></span>

                    </div>
                    <div class="col-lg-6 ">                    
                        <input type="text" class="form-control"  placeholder="Let's add some to do's" autofocus />
                    </div>
                    <div class="col-lg-3 ">
                    </div>
                </div><!-- /.row -->
            </div>
        </div>

        <!-- <> -->
        <center>
            <ul class="list-group ulcss">
                <li class="list-group-item ">


<div class="custom-control custom-checkbox">
  <input type="checkbox" class="custom-control-input" id="customCheck1">
  <label class="custom-control-label" for="customCheck1"></label>
</div>


                 <button class="destroy deletetodo"></button>   
                 </li>
               <!--  <li class="list-group-item ">Second item</li>
                <li class="list-group-item ">Third item</li>
                <li class="list-group-item ">Third item</li>
                <li class="list-group-item ">Third item</li>
                <li class="list-group-item ">Third item</li>
                <li class="list-group   -item ">Fourth item</li> -->
            </ul>

        <div class="btn-group  btncss" role="group">
            <!-- <a href="#" class="btn  btn-secondary w-100 all_todos_show">0</a> -->
            <a href="#" class="btn  btn-secondary w-100 all_todos_show">All</a>
            <a href="#" class="btn  btn-secondary w-100 completed">Completed</a>
            <a href="#" class="btn  btn-secondary w-100 uncompleted">Uncompleted</a>
            <!-- <a href="#" class="btn  btn-secondary w-100 all_todos_show">Clear completed</a> -->
            
        </div>

        </center>
         <footer class="container-fluid bg-dark custom_footer">
          <p>&copy; Habilelabs 2018-2019</p>
        </footer> 
            
    </body>
</html>

<script>

    $(document).ready(function(){
               // display todos 


        function getTodos(){            
            
            let all_todos = [];

            for (var i = 0; i < localStorage.length; i++){
                todo_from_localStorage = localStorage.getItem(localStorage.key(i));                
                if(todo_from_localStorage !== null){
                    all_todos.push( JSON.parse(todo_from_localStorage) ) ;
                }     
            } 

            all_todos.sort(function (a, b) {
                return a.order - b.order;
            });
            
            $('ul').html(''); 
            // return all_todos;
            if(all_todos.length > 0 ){
                for (var i = 0; i < all_todos.length; i++) {

                    if(all_todos[i].done == false){
                        var checkbox  =  '<input type = "checkbox" class = "c_box custom-control-input "; id="customCheck'+i+' "   value =' + all_todos[i].id + '>' ; 
                    }else{
                        var checkbox  =  '<input type = "checkbox" class = "c_box custom-control-input "; id="customCheck1'+i+'"  value =' + all_todos[i].id + ' checked>' ;
                    }

                    var checkbox_style = '<div class="custom-control custom-checkbox custom_margin" > '+ checkbox + '<label class="custom-control-label" for="customCheck'+i+'">'+ all_todos[i].title+' </label></div>';



                    var button = '<button class="destroy deletetodo" data-attr = '+ all_todos[i].id +' ></button> ' ;        
                    
                    $('ul').append('<li class="list-group-item ">'+checkbox_style +'&nbsp;' + button +     '</li>' );
                }                
            }else{
                $('.btncss').hide();
            } 
        }
         
        // getTodos();

        function getCount(){
            let totaldata = [];
            
            for (var i = 0; i < localStorage.length; i++){
                todo_from_localStorage = localStorage.getItem(localStorage.key(i));                
                if(todo_from_localStorage !== null){
                    totaldata.push( JSON.parse(todo_from_localStorage) ) ;
                }     
            } 

            totaldata.sort(function (a, b) {
                return a.order - b.order;
            });

            return totaldata;
        }


        function getremainingCount(){
            var allCount =  getCount();
            // alert('asdf');
            // console.log(allCount);
            var notDoneTodos = 0; 
            allCount.forEach(function(entry){
                if(entry.done == false){
                    notDoneTodos++;
                }
            });

            // return notDoneTodos; 
            // alert('asdf');
            $('.remainingCountHere b').html(notDoneTodos);



        }

        getremainingCount();

        var todo_item;
        var title;
        
        // add todos
        $('input[type=text]').keypress(function (event) {
            if(event.keyCode == 13){              
                title = $('input[type=text]').val();
                if (title !== '') {
                    var maxorder = Math.max.apply(Math,getCount().map(function(o){return o.order;}))
                    if(maxorder == '-Infinity'){
                        maxorder = 0;
                    }
                    unique_id = maxorder + 1;
                    var random  = Math.random().toString(36).slice(2);
                    todo_item_id = 'todo_id' + random ;
                    todo_item  = {
                        'title' : title,
                        'id' : todo_item_id,
                        'order' : unique_id,
                        'done': false 
                    }
                    localStorage.setItem(todo_item_id,JSON.stringify(todo_item));
                    window.location.reload();  
                }
            }
        }); 

        function checkUrl(){
            var t = window.location.href + '';
            var data  = t.split('?');
            if(data[1] == 'completed'){
                showCompleted();
            }else if(data[1] == 'uncompleted'){
                showUncompleted();
            }else{
                getTodos();
            }
        }

        checkUrl();

        function showCompleted(){
            $('ul').html('');
                getCount().forEach(function (entry) {
                   if(entry.done == true){
                    var checkbox = '<input type = "checkbox"; class = "c_box custom-control-input "; id="customCheck1" value =' + entry.id + ' checked>' ;
                    var button = '<button class="destroy deletetodo" data-attr = '+ entry.id +' ></button>' ;
                    $('ul').append('<li class="list-group-item">'+checkbox +'&nbsp;' + entry.title +'&nbsp;' + button +     '</li>' );
                }
            }); 
        }

        function showUncompleted() {
            $('ul').html('');
            getCount().forEach(function (entry) {
               if(entry.done == false){                
                var checkbox = '<input type = "checkbox" class = "c_box custom-control-input "; id="customCheck1" value =' + entry.id + '>' ; 
                var button = '<button class="destroy deletetodo" data-attr = '+ entry.id +' ></button>' ;
                $('ul').append('<li class="list-group-item">'+checkbox +'&nbsp;' + entry.title +'&nbsp;' + button +  '</li>' );

               }
           }); 
        }


        $('.completed').click(function() {

            var url = window.location.href + '';
            var data  = url.split('?');
            var changed = data[0] + '?completed';
            window.location = changed;
            showCompleted();

        });

        $('.uncompleted').click(function() {

            var url = window.location.href + '';
            var data  = url.split('?');
            var changed = data[0] + '?uncompleted';
            window.location = changed;
            checkUrl();            
            
        });    

        $('.all_todos_show').click(function() {            
            var url = window.location.href + '';
            var data  = url.split('?');
            var changed = data[0];
            window.location = changed;
            checkUrl(); 
        });   

        
        // update done or not 

        $('ul').on('click','.c_box',function(){ 
            var todo_id = $(this).val();
            var task_tobe_updated = localStorage.getItem(todo_id);      
            var obj_data = JSON.parse(task_tobe_updated);               
            var checked = $(this).is(':checked');
            if(checked){
                obj_data.done = true;
            }else{
                obj_data.done = false; 
            }

            localStorage.setItem(todo_id,JSON.stringify(obj_data));            
            checkUrl();   
             getremainingCount();
         
        });

        // delete todo item 

        $('ul').on('click','.deletetodo',function(){
            var id = $(this).attr('data-attr');
            localStorage.removeItem(id); 
            checkUrl();            
            getremainingCount();
        
            // getTodos
        })
    });
    

</script>




